(()=>{"use strict";class e{constructor(){this.board=this.#e(),this.ships=[],this.missedAttacks=[]}#t=new Set;#e(){const e=[];for(let t=0;t<10;t++){e[t]=[];for(let s=0;s<10;s++)e[t][s]={ship:null,attacked:!1}}return e}placeShip(e,t,s,o,n=this.board){let a=t,r=s;const c={success:!1,coordinates:[]};if(t<0||t>9||s<0||s>9)return c;const i=e.length;if("horizontal"===o)for(let e=0;e<i;e++){if(!(s>=0&&s<=9&&null===n[t][s].ship))return c.success=!1,c.coordinates=[],c;c.success=!0,c.coordinates.push([t,s]),s++}else if("vertical"===o)for(let e=0;e<i;e++){if(!(t>=0&&t<=9&&null===n[t][s].ship))return c.success=!1,c.coordinates=[],c;c.success=!0,c.coordinates.push([t,s]),t++}if(c.success){for(let t=0;t<i;t++)n[a][r].ship=e,"horizontal"===o?r++:a++;this.ships.push(e)}return c}receiveAttack(e,t,s=this.board,o=this.#t){s[e][t].attacked=!0;const n={result:void 0,ship:void 0,coordinates:[e,t]};return o.has([e,t].toString())?(n.ship=s[e][t].ship,n.result="already attacked",n):s[e][t].ship?(n.ship=s[e][t].ship,n.ship.hit(),n.result=n.ship.isSunk()?"sunk":"hit",o.add(n.coordinates.toString()),n):(n.ship=null,n.result="miss",o.add(n.coordinates.toString()),this.missedAttacks.push(n.coordinates),n)}allShipSunk(e=this.ships){return e.every(e=>e.isSunk())}}class t{constructor(t){this.name=t,this.gameboard=new e}}class s{constructor(){this.hitCount=0}hit(){return this.hitCount++,this.hitCount}isSunk(){return this.hitCount>=this.length}}class o extends s{constructor(){super(),this.length=5}}class n extends s{constructor(){super(),this.length=4}}class a extends s{constructor(){super(),this.length=3}}class r extends s{constructor(){super(),this.length=2}}class c extends s{constructor(){super(),this.length=1}}const i=new o,l=new n,u=new a,d=new a,h=new r,m=new r,p=new c,g=new c,f=new o,w=new n,S=new a,k=new a,y=new r,v=new r,M=new c,b=new c,C=["horizontal","vertical"],L=document.querySelector(".name-dialog"),q=document.querySelector("#submit-name"),x=document.querySelector("#name");x.value=localStorage.getItem("userName"),document.addEventListener("DOMContentLoaded",()=>{L.showModal()}),q.addEventListener("click",()=>{L.close(),localStorage.setItem("userName",x.value);const e=x.value,s=new t(e||"Human"),o=new t("Computer");((e,t)=>{const s=[i,l,u,d,h,m,p,g],o=[f,w,S,k,y,v,M,b];for(const e of s){let s={success:!1};for(;!s.success;){const o=Math.floor(10*Math.random()),n=Math.floor(10*Math.random()),a=Math.floor(2*Math.random());s=t.gameboard.placeShip(e,o,n,C[a])}}for(const t of o){let s={success:!1};for(;!s.success;){const o=Math.floor(10*Math.random()),n=Math.floor(10*Math.random()),a=Math.floor(2*Math.random());s=e.gameboard.placeShip(t,o,n,C[a])}}})(s,o),function(e,t){const s=function(e,t){const s=[e,t];let o=s[0],n=s[1];const a=()=>n=n===s[1]?s[0]:s[1],r=()=>n,c=()=>e.gameboard.allShipSunk()?t:t.gameboard.allShipSunk()?e:null;return{getActivePlayer:()=>o,getPassivePlayer:r,getPlayerOneBoard:()=>e.gameboard.board,getPlayerTwoBoard:()=>t.gameboard.board,playRound:(e,t,n=r())=>{const i=n.gameboard.receiveAttack(e,t);if(!c())return o=o===s[0]?s[1]:s[0],a(),i},getWinner:c}}(e,t),o=document.querySelector(".real"),n=document.querySelector(".computer"),a=document.querySelector(".outcome"),r=document.querySelector(".winner"),c=document.querySelector(".result-modal"),i=document.querySelector(".active-player-name");let l;function u(e){const t=parseInt(e.target.dataset.row),o=parseInt(e.target.dataset.column);isNaN(t)||isNaN(o)||(l=s.playRound(t,o),d())}function d(){if(i.textContent=s.getActivePlayer().name,o.textContent="",n.textContent="",l){const e={hit:"Hit!",miss:"Miss!",sunk:"Sunk!","already attacked":"Already attacked!"};a.textContent=e[l.result]||""}if(h(s.getPlayerOneBoard(),o),h(s.getPlayerTwoBoard(),n),s.getWinner())return r.textContent=`${s.getWinner().name} won!`,c.showModal(),o.removeEventListener("click",u),void n.removeEventListener("click",u);"Computer"===s.getActivePlayer().name?setTimeout(()=>{const e=Math.floor(10*Math.random()),t=Math.floor(10*Math.random());l=s.playRound(e,t),d()},500):(n.removeEventListener("click",u),n.addEventListener("click",u))}function h(e,t){e.forEach((e,s)=>{e.forEach((e,o)=>{const n=document.createElement("button");n.classList.add("cell"),n.dataset.row=s,n.dataset.column=o,"computer"!==t.classList[0]&&e.ship&&n.classList.add("ship"),e.ship&&e.attacked?n.classList.add("hit"):!e.ship&&e.attacked&&n.classList.add("miss"),t.appendChild(n)})})}document.querySelector(".real-board-name").textContent=e.name,d()}(s,o)}),document.querySelector(".play-again").addEventListener("click",()=>{window.location.reload()})})();